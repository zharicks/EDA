Traceback (most recent call last):
  File "C:\Users\sofmo\miniconda3\envs\EDA\lib\site-packages\jupyter_cache\executors\utils.py", line 58, in single_nb_execution
    executenb(
  File "C:\Users\sofmo\miniconda3\envs\EDA\lib\site-packages\nbclient\client.py", line 1314, in execute
    return NotebookClient(nb=nb, resources=resources, km=km, **kwargs).execute()
  File "C:\Users\sofmo\miniconda3\envs\EDA\lib\site-packages\jupyter_core\utils\__init__.py", line 165, in wrapped
    return loop.run_until_complete(inner)
  File "C:\Users\sofmo\miniconda3\envs\EDA\lib\asyncio\base_events.py", line 647, in run_until_complete
    return future.result()
  File "C:\Users\sofmo\miniconda3\envs\EDA\lib\site-packages\nbclient\client.py", line 709, in async_execute
    await self.async_execute_cell(
  File "C:\Users\sofmo\miniconda3\envs\EDA\lib\site-packages\nbclient\client.py", line 1062, in async_execute_cell
    await self._check_raise_for_error(cell, cell_index, exec_reply)
  File "C:\Users\sofmo\miniconda3\envs\EDA\lib\site-packages\nbclient\client.py", line 918, in _check_raise_for_error
    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
------------------
import matplotlib.pyplot as plt
from plotnine import (
    ggplot, aes, geom_bar, scale_fill_manual, labs, theme, element_text, theme_minimal
)
import pandas as pd

blue_palette = ['#023e8a', '#0096c7']

bar_plot = (
    ggplot(Dataset, aes(x='factor(action_taken)', fill='factor(lien_status)'))
    + geom_bar(position='stack', show_legend=True)  
    + scale_fill_manual(
        values=blue_palette,
        labels=["First Lien", "Subordinate Lien"]
    )
    + labs(
        title="Gr√°fico de barras acci√≥n contra estado de Lien", 
        x="Decisi√≥n", 
        y="Frecuencia", 
        fill='Estado'
    )
    + theme_minimal()  
    + theme(
        figure_size=(10, 6),  
        plot_title=element_text(size=18, weight='bold', ha='center', color='#023e8a'),  
        axis_title_x=element_text(size=14, weight='bold', color='#023e8a'),  
        axis_title_y=element_text(size=14, weight='bold', color='#023e8a'), 
        axis_text=element_text(size=12, color='#3B3B3B'),  
        legend_title=element_text(size=14, weight='bold', color='#023e8a'), 
        legend_position='right',
        legend_background=element_text(alpha=0),  
        legend_box_margin=0,
        legend_box='vertical'  
    )
)

proportion_plot = (
    ggplot(to_proportions(Dataset, 'action_taken', 'lien_status'), 
           aes(x='factor(action_taken)', y='proportion', fill='factor(lien_status)'))
    + geom_bar(stat='identity', position='stack', show_legend=True)
    + scale_fill_manual(
        values=blue_palette,
        labels=["First Lien", "Subordinate Lien"]
    )
    + labs(
        title="Proporci√≥n de acci√≥n contra estado de Lien", 
        x="Decisi√≥n", 
        y="Proporci√≥n", 
        fill='Estado'
    )
    + theme_minimal()  
    + theme(
        figure_size=(10, 6),  
        plot_title=element_text(size=18, weight='bold', ha='center', color='#023e8a'),  
        axis_title_x=element_text(size=14, weight='bold', color='#023e8a'),  
        axis_title_y=element_text(size=14, weight='bold', color='#023e8a'), 
        axis_text=element_text(size=12, color='#3B3B3B'),  
        legend_title=element_text(size=14, weight='bold', color='#023e8a'), 
        legend_position='right', 
        legend_background=element_text(alpha=0),  
        legend_box_margin=0,
        legend_box='vertical'  
    )
)

bar_plot.draw(show=True)
proportion_plot.draw(show=True)

plt.show()

------------------


[1;31m------------------------------------------------------------------------[0m
[1;31mNameError[0m                              Traceback (most recent call last)
Cell [1;32mIn[27], line 38[0m
[0;32m      7[0m blue_palette [38;5;241m=[39m [[38;5;124m'[39m[38;5;124m#023e8a[39m[38;5;124m'[39m, [38;5;124m'[39m[38;5;124m#0096c7[39m[38;5;124m'[39m]
[0;32m      9[0m bar_plot [38;5;241m=[39m (
[0;32m     10[0m     ggplot(Dataset, aes(x[38;5;241m=[39m[38;5;124m'[39m[38;5;124mfactor(action_taken)[39m[38;5;124m'[39m, fill[38;5;241m=[39m[38;5;124m'[39m[38;5;124mfactor(lien_status)[39m[38;5;124m'[39m))
[0;32m     11[0m     [38;5;241m+[39m geom_bar(position[38;5;241m=[39m[38;5;124m'[39m[38;5;124mstack[39m[38;5;124m'[39m, show_legend[38;5;241m=[39m[38;5;28;01mTrue[39;00m)  
[1;32m   (...)[0m
[0;32m     34[0m     )
[0;32m     35[0m )
[0;32m     37[0m proportion_plot [38;5;241m=[39m (
[1;32m---> 38[0m     ggplot([43mto_proportions[49m(Dataset, [38;5;124m'[39m[38;5;124maction_taken[39m[38;5;124m'[39m, [38;5;124m'[39m[38;5;124mlien_status[39m[38;5;124m'[39m), 
[0;32m     39[0m            aes(x[38;5;241m=[39m[38;5;124m'[39m[38;5;124mfactor(action_taken)[39m[38;5;124m'[39m, y[38;5;241m=[39m[38;5;124m'[39m[38;5;124mproportion[39m[38;5;124m'[39m, fill[38;5;241m=[39m[38;5;124m'[39m[38;5;124mfactor(lien_status)[39m[38;5;124m'[39m))
[0;32m     40[0m     [38;5;241m+[39m geom_bar(stat[38;5;241m=[39m[38;5;124m'[39m[38;5;124midentity[39m[38;5;124m'[39m, position[38;5;241m=[39m[38;5;124m'[39m[38;5;124mstack[39m[38;5;124m'[39m, show_legend[38;5;241m=[39m[38;5;28;01mTrue[39;00m)
[0;32m     41[0m     [38;5;241m+[39m scale_fill_manual(
[0;32m     42[0m         values[38;5;241m=[39mblue_palette,
[0;32m     43[0m         labels[38;5;241m=[39m[[38;5;124m"[39m[38;5;124mFirst Lien[39m[38;5;124m"[39m, [38;5;124m"[39m[38;5;124mSubordinate Lien[39m[38;5;124m"[39m]
[0;32m     44[0m     )
[0;32m     45[0m     [38;5;241m+[39m labs(
[0;32m     46[0m         title[38;5;241m=[39m[38;5;124m"[39m[38;5;124mProporci√≥n de acci√≥n contra estado de Lien[39m[38;5;124m"[39m, 
[0;32m     47[0m         x[38;5;241m=[39m[38;5;124m"[39m[38;5;124mDecisi√≥n[39m[38;5;124m"[39m, 
[0;32m     48[0m         y[38;5;241m=[39m[38;5;124m"[39m[38;5;124mProporci√≥n[39m[38;5;124m"[39m, 
[0;32m     49[0m         fill[38;5;241m=[39m[38;5;124m'[39m[38;5;124mEstado[39m[38;5;124m'[39m
[0;32m     50[0m     )
[0;32m     51[0m     [38;5;241m+[39m theme_minimal()  
[0;32m     52[0m     [38;5;241m+[39m theme(
[0;32m     53[0m         figure_size[38;5;241m=[39m([38;5;241m10[39m, [38;5;241m6[39m),  
[0;32m     54[0m         plot_title[38;5;241m=[39melement_text(size[38;5;241m=[39m[38;5;241m18[39m, weight[38;5;241m=[39m[38;5;124m'[39m[38;5;124mbold[39m[38;5;124m'[39m, ha[38;5;241m=[39m[38;5;124m'[39m[38;5;124mcenter[39m[38;5;124m'[39m, color[38;5;241m=[39m[38;5;124m'[39m[38;5;124m#023e8a[39m[38;5;124m'[39m),  
[0;32m     55[0m         axis_title_x[38;5;241m=[39melement_text(size[38;5;241m=[39m[38;5;241m14[39m, weight[38;5;241m=[39m[38;5;124m'[39m[38;5;124mbold[39m[38;5;124m'[39m, color[38;5;241m=[39m[38;5;124m'[39m[38;5;124m#023e8a[39m[38;5;124m'[39m),  
[0;32m     56[0m         axis_title_y[38;5;241m=[39melement_text(size[38;5;241m=[39m[38;5;241m14[39m, weight[38;5;241m=[39m[38;5;124m'[39m[38;5;124mbold[39m[38;5;124m'[39m, color[38;5;241m=[39m[38;5;124m'[39m[38;5;124m#023e8a[39m[38;5;124m'[39m), 
[0;32m     57[0m         axis_text[38;5;241m=[39melement_text(size[38;5;241m=[39m[38;5;241m12[39m, color[38;5;241m=[39m[38;5;124m'[39m[38;5;124m#3B3B3B[39m[38;5;124m'[39m),  
[0;32m     58[0m         legend_title[38;5;241m=[39melement_text(size[38;5;241m=[39m[38;5;241m14[39m, weight[38;5;241m=[39m[38;5;124m'[39m[38;5;124mbold[39m[38;5;124m'[39m, color[38;5;241m=[39m[38;5;124m'[39m[38;5;124m#023e8a[39m[38;5;124m'[39m), 
[0;32m     59[0m         legend_position[38;5;241m=[39m[38;5;124m'[39m[38;5;124mright[39m[38;5;124m'[39m, 
[0;32m     60[0m         legend_background[38;5;241m=[39melement_text(alpha[38;5;241m=[39m[38;5;241m0[39m),  
[0;32m     61[0m         legend_box_margin[38;5;241m=[39m[38;5;241m0[39m,
[0;32m     62[0m         legend_box[38;5;241m=[39m[38;5;124m'[39m[38;5;124mvertical[39m[38;5;124m'[39m  
[0;32m     63[0m     )
[0;32m     64[0m )
[0;32m     66[0m bar_plot[38;5;241m.[39mdraw(show[38;5;241m=[39m[38;5;28;01mTrue[39;00m)
[0;32m     67[0m proportion_plot[38;5;241m.[39mdraw(show[38;5;241m=[39m[38;5;28;01mTrue[39;00m)

[1;31mNameError[0m: name 'to_proportions' is not defined

